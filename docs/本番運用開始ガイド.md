# 貿易DX V2.1 Webアプリ - 本番運用開始ガイド

## 📋 目次
1. [システム完成の確認](#システム完成の確認)
2. [本番運用前の準備](#本番運用前の準備)
3. [本番環境への展開](#本番環境への展開)
4. [データ移行手順](#データ移行手順)
5. [運用開始チェックリスト](#運用開始チェックリスト)
6. [ユーザー教育](#ユーザー教育)
7. [運用体制の構築](#運用体制の構築)
8. [トラブルシューティング](#トラブルシューティング)

---

## ✅ システム完成の確認

### 開発フェーズ完了状況
- **Phase 1**: ✅ 環境構築とデータベース設計
- **Phase 2**: ✅ 認証機能
- **Phase 3**: ✅ 案件管理API
- **Phase 4**: ✅ マスタ管理
- **Phase 5**: ✅ ダッシュボード・集計機能
- **Phase 6**: ✅ ドキュメント生成機能
- **Phase 7**: ✅ 変更履歴・バックアップ
- **Phase 8**: ✅ リアルタイム同期・通知
- **Phase 9**: ✅ テストとデバッグ

**全体進捗: 9/9 (100%)**

### テスト結果
- **バックエンド**: 65テスト、100%成功、78%カバレッジ
- **フロントエンド**: Vitest 3テスト成功、E2E 6テスト成功
- **主要機能**: 全て動作確認済み

### 実装済み機能
- ✅ ユーザー認証（ログイン・ログアウト）
- ✅ 案件管理（CRUD、検索・フィルター）
- ✅ 案件番号自動生成
- ✅ 顧客マスタ管理
- ✅ 商品マスタ管理
- ✅ ダッシュボード・統計機能
- ✅ ドキュメント生成（Invoice、Packing List）
- ✅ 変更履歴管理
- ✅ バックアップ・復元機能
- ✅ リアルタイム同期・通知

---

## 🚀 本番運用前の準備

### 1. 環境要件の確認

#### サーバー要件
- **OS**: Windows Server 2019以降 / Linux (Ubuntu 20.04以降)
- **CPU**: 2コア以上推奨
- **メモリ**: 4GB以上推奨
- **ストレージ**: 20GB以上（データベース・バックアップ用）
- **ネットワーク**: 社内LAN接続、必要に応じてインターネット接続

#### ソフトウェア要件
- **Python**: 3.11以上
- **Node.js**: 18以上
- **データベース**: PostgreSQL 15+（本番環境推奨）または SQLite（小規模環境）
- **Webサーバー**: Nginx（オプション、リバースプロキシ用）

### 2. セキュリティ設定

#### 必須設定項目
- [x] **ローカル環境**: JWT秘密鍵の設定完了（`C:\opt\trade-dx\backend\.env`）
  - **注意**: 本番環境では別の強力な秘密鍵に変更してください
- [ ] **本番環境**: 本番環境用の強力なパスワード設定
- [ ] **本番環境**: JWT秘密鍵の変更（本番用の強力な値に更新）
- [ ] **本番環境**: HTTPSの設定（本番環境では必須）
- [ ] **本番環境**: ファイアウォール設定（必要なポートのみ開放）
- [ ] **本番環境**: データベースアクセス制限
- [ ] **本番環境**: バックアップファイルの暗号化（オプション）

#### パスワードポリシー
- 管理者アカウント: 12文字以上、大文字・小文字・数字・記号を含む
- 一般ユーザー: 8文字以上、大文字・小文字・数字を含む
- 定期的なパスワード変更（90日ごと推奨）

### 3. バックアップ戦略の確認

#### 自動バックアップ設定
- **頻度**: 1日1回（深夜推奨）
- **保持期間**: 30日間
- **保存先**: 別サーバーまたはクラウドストレージ（推奨）

#### 手動バックアップ
- 重要な操作前（データ移行、システム更新など）
- 週次バックアップ（金曜日推奨）

#### バックアップ確認項目
- [ ] バックアップが正常に作成されることを確認
- [ ] 復元手順のテスト実施
- [ ] バックアップファイルの保存場所の確認

---

## 🏗️ 本番環境への展開

### 📊 進捗状況（2025-12-15 更新）

#### ✅ 完了済み（ローカル環境でのセットアップ）
- [x] **ローカル環境でのディレクトリ構造の作成**
  - 場所: `C:\opt\trade-dx\`
  - 構成: `backend/`, `frontend/` ディレクトリ作成済み
- [x] **アプリケーションの配置**
  - 開発環境から本番相当環境への配置完了
  - Gitリポジトリへのコミット完了（全ソースコード、ドキュメント、スクリプト）
- [x] **依存関係のインストール**
  - バックエンド: Python依存関係インストール完了
  - フロントエンド: npm依存関係インストール完了、ビルド成功
- [x] **環境変数の設定**
  - バックエンド: `C:\opt\trade-dx\backend\.env` 作成済み
  - フロントエンド: `C:\opt\trade-dx\frontend\.env.production` 作成済み
  - 詳細は [設定一覧.md](./設定一覧.md) を参照
- [x] **動作確認**
  - バックエンド: `http://localhost:8000` で起動確認済み
  - フロントエンド: `http://localhost:3000` で起動確認済み
  - Swagger UI: `http://localhost:8000/docs` でAPI確認可能

#### ⏳ 未完了（本番サーバーへの展開）
- [ ] **VPS/クラウドVMの準備** ← **次のステップ**
  - サーバー契約・セットアップ
  - ドメイン取得（オプション）
  - **詳細手順**: [VPSセットアップガイド](./VPSセットアップガイド.md) を参照
- [ ] **本番サーバーへのデプロイ**
  - サーバーへのファイル転送
  - 本番環境での依存関係インストール
- [ ] **データベースの初期化（本番環境）**
  - マイグレーション実行
  - シードデータ投入
- [ ] **セキュリティ設定**
  - 本番用SECRET_KEYの設定
  - HTTPS/SSL証明書の設定
  - ファイアウォール設定
- [ ] **サービス起動設定**
  - systemd（Linux）またはNSSM（Windows）でのサービス化
- [ ] **リバースプロキシ設定**
  - Nginx設定（オプション）
- [ ] **バックアップ設定**
  - 自動バックアップの設定
- [ ] **データ移行**
  - 既存Excelデータからの移行（該当する場合）

---

### ステップ1: 本番サーバーのセットアップ

#### 1.1 ディレクトリ構造の作成
```bash
# 本番環境用ディレクトリ
# Windows: C:\opt\trade-dx\
# Linux: /opt/trade-dx/
/opt/trade-dx/          # アプリケーション本体
├── backend/
├── frontend/
├── backups/            # バックアップ保存先
├── logs/               # ログファイル
└── data/               # データベースファイル（SQLiteの場合）
```

**✅ ローカル環境での完了状況**: `C:\opt\trade-dx\` にディレクトリ構造作成済み

#### 1.2 アプリケーションの配置
```bash
# 開発環境から本番環境へコピー
# 注意: .envファイル、データベースファイル、node_modulesは除外
```

**✅ ローカル環境での完了状況**: アプリケーション配置完了、Gitリポジトリにコミット済み

#### 1.3 依存関係のインストール
```bash
# バックエンド
cd /opt/trade-dx/backend
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# フロントエンド
cd /opt/trade-dx/frontend
npm install --production
npm run build
```

**✅ ローカル環境での完了状況**: 依存関係インストール完了、フロントエンドビルド成功

### ステップ2: データベースの初期化

#### 2.1 PostgreSQLを使用する場合（推奨）
```bash
# PostgreSQLデータベースの作成
createdb trade_dx_production

# 環境変数の設定
export DATABASE_URL="postgresql://user:password@localhost/trade_dx_production"

# マイグレーションの実行
cd backend
alembic upgrade head

# シードデータの投入
python scripts/seed_data.py
```

#### 2.2 SQLiteを使用する場合（小規模環境）
```bash
cd backend
# マイグレーションの実行
alembic upgrade head

# シードデータの投入
python scripts/seed_data.py
```

### ステップ3: 環境変数の設定

#### 3.1 バックエンド環境変数（`.env`ファイル）
```env
# データベース
DATABASE_URL=postgresql://user:password@localhost/trade_dx_production
# または
DATABASE_URL=sqlite:///./trade_dx.db

# JWT認証
SECRET_KEY=本番環境用の強力な秘密鍵（32文字以上推奨）
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=480

# CORS設定
CORS_ORIGINS=https://your-domain.com,https://www.your-domain.com

# ログレベル
LOG_LEVEL=INFO
```

**✅ ローカル環境での完了状況**:
- ファイル: `C:\opt\trade-dx\backend\.env`
- 現在の設定: SQLite使用、ローカル開発用設定
- **注意**: 本番環境ではSECRET_KEYを変更し、CORS_ORIGINSを本番URLに更新してください
- 詳細は [設定一覧.md](./設定一覧.md) を参照

#### 3.2 フロントエンド環境変数（`.env.production`ファイル）
```env
VITE_API_BASE_URL=https://api.your-domain.com
# または
VITE_API_BASE_URL=http://your-server-ip:8000
```

**✅ ローカル環境での完了状況**:
- ファイル: `C:\opt\trade-dx\frontend\.env.production`
- 現在の設定: `http://localhost:8000`（ローカル開発用）
- **注意**: 本番環境では本番サーバーのURLに更新してください

### ステップ4: サービス起動設定

#### 4.1 Windows環境（サービス化）
```batch
# NSSMを使用してWindowsサービスとして登録
# バックエンド
nssm install TradeDXBackend "C:\Python311\python.exe" "-m" "uvicorn" "app.main:app" "--host" "0.0.0.0" "--port" "8000"
nssm set TradeDXBackend AppDirectory "C:\opt\trade-dx\backend"
nssm start TradeDXBackend

# フロントエンド（Nginxを使用する場合）
# Nginxの設定ファイルを編集
```

#### 4.2 Linux環境（systemd）
```ini
# /etc/systemd/system/trade-dx-backend.service
[Unit]
Description=Trade DX Backend API
After=network.target

[Service]
Type=simple
User=trade-dx
WorkingDirectory=/opt/trade-dx/backend
Environment="PATH=/opt/trade-dx/backend/venv/bin"
ExecStart=/opt/trade-dx/backend/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
# サービスの有効化と起動
sudo systemctl enable trade-dx-backend
sudo systemctl start trade-dx-backend
sudo systemctl status trade-dx-backend
```

### ステップ5: リバースプロキシの設定（Nginx）

#### 5.1 Nginx設定例
```nginx
# /etc/nginx/sites-available/trade-dx
server {
    listen 80;
    server_name your-domain.com;

    # フロントエンド
    location / {
        root /opt/trade-dx/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # バックエンドAPI
    location /api {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket
    location /ws {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

---

## 📦 データ移行手順

### 既存Excelシステムからの移行

#### ステップ1: データエクスポート
1. 既存のExcelファイルからデータを抽出
2. CSV形式でエクスポート（顧客、商品、案件データ）

#### ステップ2: データ変換スクリプトの作成
```python
# scripts/migrate_from_excel.py
# ExcelデータをWebアプリのデータ形式に変換するスクリプト
```

#### ステップ3: データインポート
```bash
cd backend
python scripts/migrate_from_excel.py --input data/exported_data.csv
```

#### ステップ4: データ検証
- [ ] 顧客データの件数確認
- [ ] 商品データの件数確認
- [ ] 案件データの件数確認
- [ ] 金額計算の確認
- [ ] 案件番号の整合性確認

---

## ✅ 運用開始チェックリスト

### 展開前チェックリスト

#### ローカル環境（開発・テスト用）
- [x] ローカル環境でのディレクトリ構造作成完了
- [x] アプリケーションの配置完了
- [x] 依存関係のインストール完了
- [x] 環境変数の設定完了（ローカル開発用）
- [x] バックエンド起動確認完了
- [x] フロントエンドビルド・起動確認完了
- [x] Gitリポジトリへのコミット完了

#### 本番環境（VPS/クラウドVM）
- [ ] 本番サーバーのセットアップ完了
- [ ] データベースの初期化完了
- [ ] 環境変数の設定完了（本番用）
- [ ] サービス起動設定完了
- [ ] リバースプロキシの設定完了（Nginx使用時）
- [ ] ファイアウォール設定完了
- [ ] SSL証明書の設定完了（HTTPS使用時）
- [ ] バックアップ設定完了
- [ ] ログ出力設定完了

### 機能確認チェックリスト
- [ ] ログイン機能の確認
- [ ] 案件管理機能の確認
- [ ] 顧客マスタ管理機能の確認
- [ ] 商品マスタ管理機能の確認
- [ ] ダッシュボード表示の確認
- [ ] ドキュメント生成機能の確認
- [ ] 変更履歴機能の確認
- [ ] バックアップ機能の確認
- [ ] リアルタイム同期機能の確認

### パフォーマンス確認
- [ ] レスポンス時間の測定（目標: 1秒以内）
- [ ] 同時接続数のテスト（目標: 10ユーザー以上）
- [ ] データベースクエリの最適化確認
- [ ] メモリ使用量の確認

### セキュリティ確認
- [ ] パスワードポリシーの適用確認
- [ ] JWTトークンの有効期限確認
- [ ] CORS設定の確認
- [ ] SQLインジェクション対策の確認
- [ ] XSS対策の確認

---

## 👥 ユーザー教育

### 1. ユーザーマニュアルの作成

#### 必須項目
- ログイン方法
- 基本的な操作方法（案件登録、編集、削除）
- マスタデータの登録方法
- ドキュメント生成方法
- ダッシュボードの見方
- よくある質問（FAQ）

#### 推奨項目
- スクリーンショット付き操作手順
- 動画マニュアル（デモ動画）
- トラブルシューティングガイド

### 2. 研修の実施

#### 研修内容
- **管理者向け研修**（2時間）
  - システム管理方法
  - バックアップ・復元手順
  - ユーザー管理方法

- **一般ユーザー向け研修**（1時間）
  - 基本的な操作方法
  - よく使う機能の説明
  - トラブル時の対処法

### 3. サポート体制の構築

#### サポートチャネル
- メールサポート
- 社内チャット（Slack、Teams等）
- 電話サポート（緊急時）

#### サポート時間
- 平日 9:00-18:00（推奨）
- 緊急時対応（24時間体制、オプション）

---

## 🔧 運用体制の構築

### 1. 運用担当者の配置

#### 推奨体制
- **システム管理者**: 1名（バックアップ、ユーザー管理、システム更新）
- **サポート担当**: 1-2名（ユーザーサポート、問い合わせ対応）
- **開発担当**: 1名（バグ修正、機能追加、システム改善）

### 2. 定期メンテナンス

#### 日次作業
- [ ] バックアップの確認
- [ ] ログファイルの確認
- [ ] システム稼働状況の確認

#### 週次作業
- [ ] バックアップファイルの検証
- [ ] ディスク使用量の確認
- [ ] パフォーマンス監視

#### 月次作業
- [ ] セキュリティアップデートの適用
- [ ] データベースの最適化
- [ ] ログファイルのアーカイブ
- [ ] ユーザーフィードバックの収集

### 3. 監視・アラート設定

#### 監視項目
- サーバーリソース（CPU、メモリ、ディスク）
- データベース接続数
- APIレスポンス時間
- エラーログ

#### アラート設定
- ディスク使用率が80%を超えた場合
- メモリ使用率が90%を超えた場合
- APIエラーが連続で発生した場合
- バックアップが失敗した場合

---

## 🆘 トラブルシューティング

### よくある問題と解決方法

#### 問題1: ログインできない
**原因**: パスワードが間違っている、ユーザーが存在しない
**解決策**:
1. パスワードを確認
2. 管理者に連絡してユーザー情報を確認
3. データベースでユーザー情報を直接確認

#### 問題2: データが表示されない
**原因**: データベース接続エラー、フィルター設定の問題
**解決策**:
1. ブラウザのコンソールでエラーを確認
2. バックエンドのログを確認
3. データベース接続を確認

#### 問題3: ドキュメントが生成できない
**原因**: テンプレートファイルが見つからない、権限の問題
**解決策**:
1. テンプレートファイルの存在を確認
2. ファイルの読み取り権限を確認
3. ログファイルでエラー詳細を確認

#### 問題4: バックアップが失敗する
**原因**: ディスク容量不足、権限の問題
**解決策**:
1. ディスク容量を確認
2. バックアップディレクトリの権限を確認
3. 手動バックアップを試行

### 緊急時の対応手順

#### システムダウンの場合
1. サービスステータスを確認
2. ログファイルでエラーを確認
3. データベース接続を確認
4. 必要に応じてサービスを再起動
5. 復旧できない場合はバックアップから復元

#### データ消失の場合
1. 最新のバックアップを確認
2. バックアップからデータを復元
3. データ整合性を確認
4. 原因を調査（ログファイルを確認）

---

## 📞 サポート連絡先

### 技術サポート
- **メール**: support@your-company.com
- **電話**: 03-XXXX-XXXX（平日 9:00-18:00）

### 緊急連絡先
- **電話**: 090-XXXX-XXXX（24時間対応）

---

## 📝 次のステップ

### 短期（1ヶ月以内）
1. ⏳ **本番環境への展開** ← **現在ここ**
   - [ ] VPS/クラウドVMの契約・セットアップ
   - [ ] 本番サーバーへのデプロイ
   - [ ] 本番環境での動作確認
2. [ ] **データ移行の完了**
   - [ ] 既存データの移行（該当する場合）
   - [ ] データ整合性の確認
3. [ ] **ユーザー教育の実施**
   - [ ] ユーザーマニュアルの配布
   - [ ] 研修の実施
4. [ ] **運用体制の構築**
   - [ ] 運用担当者の配置
   - [ ] サポート体制の構築

### 中期（3ヶ月以内）
1. ユーザーフィードバックの収集
2. パフォーマンスの最適化
3. 追加機能の検討
4. セキュリティ監査の実施

### 長期（6ヶ月以内）
1. システム改善の実施
2. 新機能の追加
3. モバイル対応の検討（オプション）
4. API連携の拡張（オプション）

---

## 📚 関連ドキュメント

- [クイックスタートガイド](../QUICKSTART.md)
- [全体進捗管理書](../進捗管理/全体進捗管理書.md)
- [Phase 9 手動操作手順書](../進捗管理/フェーズ進捗メモ/Phase9_手動操作手順書.md)
- [詳細設計書](./貿易DX_詳細設計書_v2.1_実運用強化版.docx)

---

**最終更新**: 2025-12-15
**バージョン**: V2.1 Web
**ステータス**: 開発完了、ローカル環境セットアップ完了、本番サーバー展開待ち

### 📌 現在の状況サマリー

**完了済み**:
- ✅ 全開発フェーズ（Phase 1-9）完了
- ✅ ローカル環境でのセットアップ完了（`C:\opt\trade-dx\`）
- ✅ 環境変数設定完了（ローカル開発用）
- ✅ 動作確認完了（バックエンド・フロントエンド）
- ✅ Gitリポジトリへのコミット完了

**次のアクション**:
1. VPS/クラウドVMの契約・セットアップ
2. 本番サーバーへのデプロイ
3. 本番環境での環境変数設定（SECRET_KEY、CORS_ORIGINS等の更新）
4. サービス起動設定（systemd/NSSM）
5. セキュリティ設定（HTTPS、ファイアウォール）
