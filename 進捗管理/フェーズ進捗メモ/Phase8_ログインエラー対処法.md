# Phase 8: ログインエラー対処法

## 問題: ログインできない

ログインできない場合、以下の原因が考えられます：

1. **データベースにユーザーが存在しない**
2. **バックエンドサーバーが起動していない**
3. **CORSエラー**
4. **ネットワークエラー**

---

## 解決方法

### 1. データベースにユーザーが存在するか確認

#### 方法1: シードデータを投入（推奨）

**推奨方法: バッチファイルを使用**

```batch
cd backend
scripts\run_seed_with_venv.bat
```

このバッチファイルは仮想環境のアクティベートを自動で行います。

**手動で実行する場合**:

```batch
cd backend
venv\Scripts\activate.bat
python scripts\seed_data.py
```

**注意**: 仮想環境をアクティベートしないと `ModuleNotFoundError: No module named 'sqlalchemy'` エラーが発生します。

これで以下のユーザーが作成されます：
- **ユーザー名**: `admin` / **パスワード**: `admin123`
- **ユーザー名**: `yamada` / **パスワード**: `yamada123`
- **ユーザー名**: `suzuki` / **パスワード**: `suzuki123`

#### 方法2: テストユーザーを追加

**手動で実行する場合**:

```batch
cd backend
venv\Scripts\activate.bat
python scripts\add_testuser.py
```

**注意**: 仮想環境をアクティベートしないと `ModuleNotFoundError` エラーが発生します。

これで以下のユーザーが作成されます：
- **ユーザー名**: `testuser` / **パスワード**: `testpass123`

### 2. バックエンドサーバーが起動しているか確認

1. ブラウザで http://localhost:8000/docs にアクセス
2. APIドキュメントが表示されれば、サーバーは起動しています
3. 表示されない場合は、バックエンドサーバーを起動してください

```batch
cd backend
start_server.bat
```

### 3. ブラウザのコンソールでエラーを確認

1. ブラウザの開発者ツールを開く（F12キー）
2. 「Console」タブを開く
3. ログインを試みる
4. エラーメッセージを確認

**よくあるエラー**:

- **`Network Error` または `ERR_CONNECTION_REFUSED`**
  - バックエンドサーバーが起動していない
  - 解決: バックエンドサーバーを起動

- **`CORS policy` エラー**
  - CORS設定の問題
  - 解決: `backend/app/core/config.py` の `CORS_ORIGINS` を確認

- **`401 Unauthorized`**
  - ユーザー名またはパスワードが間違っている
  - 解決: 正しいユーザー名とパスワードを入力

- **`500 Internal Server Error`**
  - サーバー側のエラー
  - 解決: バックエンドサーバーのログを確認

### 4. ネットワークタブでリクエストを確認

1. ブラウザの開発者ツールを開く（F12キー）
2. 「Network」タブを開く
3. ログインを試みる
4. `/api/auth/login` のリクエストを確認

**確認ポイント**:
- リクエストが送信されているか
- ステータスコード（200, 401, 500など）
- レスポンスの内容

---

## トラブルシューティング

### 問題1: 「サーバーに接続できません」というエラー

**原因**: バックエンドサーバーが起動していない

**解決方法**:
1. バックエンドサーバーを起動
2. http://localhost:8000/docs にアクセスして確認

### 問題2: 「ユーザー名またはパスワードが正しくありません」というエラー

**原因**: データベースにユーザーが存在しない、またはパスワードが間違っている

**解決方法**:
1. シードデータを投入（`python scripts\seed_data.py`）
2. 正しいユーザー名とパスワードを入力

### 問題3: CORSエラー

**症状**: ブラウザのコンソールに `CORS policy` エラーが表示される

**解決方法**:
1. `backend/app/core/config.py` を確認
2. `CORS_ORIGINS` に `http://localhost:3000` が含まれているか確認

### 問題4: ログイン後、すぐにログアウトされる

**原因**: トークンの保存に失敗している可能性

**解決方法**:
1. ブラウザの開発者ツールで「Application」タブを開く
2. 「Local Storage」を確認
3. `access_token` と `user` が保存されているか確認

---

## 確認チェックリスト

- [ ] バックエンドサーバーが起動している
- [ ] フロントエンドサーバーが起動している
- [ ] データベースにユーザーが存在する
- [ ] ブラウザのコンソールにエラーがない
- [ ] ネットワークタブでリクエストが送信されている
- [ ] 正しいユーザー名とパスワードを入力している

---

## デフォルトのユーザーアカウント

シードデータ投入後、以下のアカウントでログインできます：

| ユーザー名 | パスワード | 権限 |
|-----------|-----------|------|
| admin | admin123 | 管理者 |
| yamada | yamada123 | 一般ユーザー |
| suzuki | suzuki123 | 一般ユーザー |

---

**ログインできない場合は、上記の手順を順番に確認してください。**
